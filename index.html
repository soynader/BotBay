<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <meta name="theme-color" content="#161b22"/>
  <title>Asesor Bayport IA</title>
  <style>
    :root {
      --bg: #0d1117;
      --surface: #161b22;
      --surface2: #21262d;
      --accent: #00c2cb;
      --text: #c9d1d9;
      --subtle: #8b949e;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
    
    html, body {
      height: 100%;
      overflow: hidden;
    }
    
    body { 
      display: flex; 
      flex-direction: column; 
      background: var(--bg); 
      color: var(--text);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
    }
    
    header { 
      background: var(--surface); 
      padding: .75rem 1rem; 
      text-align: center; 
      box-shadow: 0 2px 8px rgba(0,0,0,.4);
      flex-shrink: 0;
    }
    
    header h1 { 
      font-size: 1.2rem; 
      font-weight: 600; 
    }

    main { 
      flex: 1; 
      overflow-y: auto; 
      padding: .75rem; 
      display: flex; 
      flex-direction: column; 
      scroll-behavior: smooth;
      padding-bottom: 80px;
    }
    
    #messages { 
      width: 100%;
      max-width: 100%;
      display: flex;
      flex-direction: column;
      gap: .5rem;
    }
    
    #messages > div { 
      padding: .8rem 1rem; 
      border-radius: 18px; 
      word-wrap: break-word; 
      font-size: .95rem; 
      line-height: 1.4;
      max-width: 100%;
      width: auto;
    }
    
    .user { 
      background: var(--accent); 
      color: #000; 
      border-bottom-right-radius: 4px; 
      align-self: flex-end;
      text-align: right;
    }
    
    .bot  { 
      background: var(--surface2); 
      border-bottom-left-radius: 4px; 
      color: var(--text); 
      align-self: flex-start;
      text-align: left;
    }

    footer { 
      display: flex; 
      padding: .6rem .75rem; 
      background: var(--surface); 
      border-top: 1px solid var(--surface2);
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 1000;
    }
    
    #input { 
      flex: 1; 
      padding: .7rem .9rem; 
      border: none; 
      border-radius: 24px; 
      background: var(--surface2); 
      color: var(--text); 
      outline: none; 
      font-size: 1rem;
      margin-right: .5rem;
    }
    
    #input::placeholder { 
      color: var(--subtle); 
    }
    
    #sendBtn { 
      border: none; 
      background: var(--accent); 
      color: #000; 
      padding: .75rem; 
      border-radius: 50%; 
      cursor: pointer; 
      font-size: 1.2rem; 
      transition: transform .15s; 
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #sendBtn:active { 
      transform: scale(.9); 
    }

    @media (max-width: 480px) {
      header {
        padding: .6rem .75rem;
      }
      
      header h1 {
        font-size: 1.1rem;
      }
      
      main {
        padding: .5rem;
      }
      
      #messages > div {
        font-size: .9rem;
        padding: .7rem .85rem;
      }
      
      footer {
        padding: .5rem;
      }
      
      #input {
        font-size: .95rem;
        padding: .65rem .8rem;
      }
    }

    @media (min-width: 600px) {
      body {
        max-width: 600px;
        margin: 0 auto;
        left: 50%;
        transform: translateX(-50%);
      }
      
      footer {
        max-width: 600px;
        left: 50%;
        transform: translateX(-50%);
      }
    }

    @media screen and (-webkit-min-device-pixel-ratio: 0) {
      select:focus,
      textarea:focus,
      input:focus {
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Asesor Bayport IA</h1>
  </header>
  <main id="chat">
    <div id="messages"></div>
  </main>
  <footer>
    <input id="input" type="text" placeholder="Escribí la pregunta del cliente…" autocomplete="off"/>
    <button id="sendBtn">➤</button>
  </footer>

  <script>
    const KNOWLEDGE = `
# 🚀 Kit de Asesoría Freelance – Bayport Colombia

## 📌 Perfil del Cliente Ideal
- **Edad**: 25-55 años
- **Ingresos**: $2.500.000 - $8.000.000 COP
- **Perfil**: Empleados formales, pensionados, independientes con 2 años de experiencia
- **Nivel de endeudamiento**: < 40% de sus ingresos
- **Propósito**: Consolidar deudas, mejorar cash-flow, inversión personal

## 🎯 Productos Clave

### 📊 Línea Libre Inversión
- **Monto**: 1-50 millones COP
- **Plazo**: 12-84 meses
- **Tasa**: Desde 1.4% mensual
- **Desembolso**: 24-48 horas
- **Documentación**: Mínima (solo cédula y desprendibles)

### 🔁 Reestructuración de Deudas
- **Beneficio**: Reduce pagos mensuales hasta 50%
- **Incluye**: Tarjetas de crédito, créditos de libranza, vehículo, vivienda
- **Ventaja**: Un solo pago mensual

### 💼 Crédito por Libranza
- **Deducción**: Directo de nómina/pensión
- **Seguro**: Cubre riesgos de vida y desempleo
- **Tasa**: Reducida por deducción automática

## 🛡️ Beneficios Exclusivos
- **Seguro de vida**: Incluido sin costo
- **Aprobación**: 95% de clientes califican
- **Flexibilidad**: Pago anticipado sin penalidades
- **Atención**: Personalizada 24/7

## 📋 Requisitos Mínimos
1. **Cédula ciudadanía**
2. **Desprendible de nómina** (últimos 2 meses)
3. **Certificado laboral** (mínimo 6 meses)
4. **Extractos bancarios** (opcional para mejor tasa)

## 💳 Comparativa Competitiva
| Característica     | Bayport | Bancos | Cooperativas |
|--------------------|---------|--------|--------------|
| Aprobación         | 95%     | 40%    | 70%          |
| Desembolso         | 24h     | 7-15 días | 3-5 días |
| Tasa promedio      | 1.4%    | 2.5%   | 1.8%         |
| Documentación      | Mínima  | Extensa| Media        |

## 🎯 Objecciones Comunes y Respuestas

### "La tasa es muy alta"
→ Comparada con tarjetas de crédito (3.5% mensual), nuestra tasa es 60% más baja. Además, incluye seguro de vida.

### "Prefiero esperar"
→ Cada día que espera, paga más intereses. Con nuestro promedio de ahorro de $300.000 mensual, esperar 3 meses le cuesta $900.000.

### "No estoy seguro"
→ Ofrecemos evaluación gratuita sin compromiso. Solo necesita su cédula para una pre-aprobación en 5 minutos.

### "Tengo miedo de endeudarme más"
→ Esta es precisamente la solución para reducir su endeudamiento total. Consolidamos todas sus deudas en una sola cuota menor.

## 📞 Cierre Efectivo
"Señor/a [Nombre], con su permiso, ¿podemos hacer la solicitud ahora? Solo necesito 5 minutos y su cédula. En 24 horas tendrá el dinero en su cuenta y empezará a ahorrar desde el primer mes."

## ⚡ Llamado a la Acción
"¿Tiene 5 minutos ahora? Puedo hacer la pre-aprobación inmediatamente y en 24 horas tendrá su dinero."

## 📱 Contacto
- **WhatsApp**: 300-123-4567
- **Horario**: Lunes a viernes 8 AM - 8 PM
- **Sábados**: 9 AM - 2 PM

---
**Recuerda**: Cada cliente tiene necesidades únicas. Adapta esta información según su perfil específico.
    `;

    const messages = document.getElementById('messages');
    const input    = document.getElementById('input');
    const sendBtn  = document.getElementById('sendBtn');

    // Configuración removida - ahora usa Netlify Functions

    sendBtn.onclick = sendMessage;
    input.addEventListener('keydown', e => { if (e.key === 'Enter') sendMessage(); });

    async function sendMessage() {
      const text = input.value.trim();
      if (!text) return;
      appendMessage(text, 'user');
      input.value = '';
      const reply = await askGroq(text);
      appendMessage(reply, 'bot');
    }

    function appendMessage(text, cls) {
      const div = document.createElement('div');
      div.className = cls;
      div.textContent = text;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    }

    async function askGroq(question) {
      try {
        const res = await fetch('/.netlify/functions/ask-groq', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ question })
        });
        
        const data = await res.json();
        
        if (!res.ok) {
          throw new Error(data.error || 'Error en la respuesta');
        }
        
        return data.response || 'Sin respuesta disponible';
      } catch (e) {
        console.error('Error:', e);
        return 'Error al conectar con el servidor. Intenta nuevamente.';
      }
    }
  </script>
</body>
</html>
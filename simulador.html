<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Simulador de Crédito</title>
  <style>
    :root{
      --bg: #0a0a0a;
      --surface: #1a1a1a;
      --surface2: #2a2a2a;
      --text: #ffffff;
      --subtle: #888888;
      --accent: #d4c00f;
    }
    * { box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); padding: 20px; margin:0; overflow-x: hidden; width: 100%; }
    .simulador { max-width: 600px; width: 100%; margin: auto; background: var(--surface); padding: 20px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.3); border:1px solid var(--surface2); }
    .simulador h2 { margin-bottom: 20px; text-align: center; }
    label { display: block; margin-top: 15px; font-weight: 600; }
    input, select { width: 100%; padding: 10px; margin-top: 6px; border: 1px solid var(--surface2); border-radius: 8px; font-size: 16px; background: var(--surface2); color: var(--text); box-sizing: border-box; }
    .btn { margin-top: 20px; width: 100%; padding: 12px; background: var(--accent); color: #000; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; box-sizing: border-box; }
    .btn:hover { filter: brightness(1.1); }
    .resultados { margin-top: 25px; padding: 15px; background: var(--surface2); border-radius: 8px; }
    .row { display: flex; justify-content: space-between; margin: 8px 0; flex-wrap: wrap; }
    .label { font-weight: bold; }
    .topbar{ display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;}
    .back-btn{ background: var(--surface2); color: var(--text); border:none; padding:6px 10px; border-radius:6px; cursor:pointer; }
    .back-btn:hover{ background: var(--accent); color:#000; }

    /* Header de la página simulador */
    .page-header { 
      position: sticky; top: 0; z-index: 10; 
      background: var(--surface); 
      padding: .8rem 1rem; 
      border-bottom: 1px solid var(--surface2); 
      display: flex; justify-content: space-between; align-items: center;
      width: 100%;
      box-sizing: border-box;
    }
    .page-header h1 { margin: 0; font-size: 1.1rem; font-weight: 600; }

    @media (max-width: 600px) {
      body { padding: 10px; }
      .simulador { padding: 16px; border-radius: 10px; width: calc(100% - 20px); margin: 10px auto; }
      .simulador h2 { font-size: 1.2rem; }
      label { margin-top: 12px; font-size: 0.95rem; }
      input, select { padding: 12px; font-size: 16px; } /* evita zoom en iOS */
      .btn { padding: 12px; font-size: 1rem; }
      .row { flex-direction: column; align-items: flex-start; gap: 4px; }
      .topbar { gap: 8px; }
      .page-header { padding: .8rem .5rem; }
    }

    @media (max-width: 400px) {
      body { padding: 8px; }
      .simulador { padding: 12px; width: calc(100% - 16px); }
      .back-btn { padding: 6px 8px; font-size: 0.9rem; }
      .simulador h2 { font-size: 1.05rem; }
      .page-header { padding: .6rem .4rem; }
      .page-header h1 { font-size: 1rem; }
    }

    /* Evitar zoom al enfocar inputs en navegadores WebKit */
    @media screen and (-webkit-min-device-pixel-ratio: 0) {
      select:focus,
      textarea:focus,
      input:focus { font-size: 16px; }
    }
  </style>
</head>
<body>
  <header class="page-header">
    <button class="back-btn" onclick="window.location.href='/chatbot.html'">← Volver</button>
    <h1>Simulador</h1>
    <div style="width:60px"></div>
  </header>
  <div class="simulador">
    
    <form id="simuladorForm">
      <label for="monto">Monto solicitado ($)</label>
      <input type="text" id="monto" placeholder="Ej: 50000000" required>

      <label for="plazo">Plazo (meses)</label>
      <select id="plazo" required>
        <option value="">Seleccione el plazo</option>
        <option value="24">24 meses (2 años)</option>
        <option value="36">36 meses (3 años)</option>
        <option value="48">48 meses (4 años)</option>
        <option value="60">60 meses (5 años)</option>
        <option value="72">72 meses (6 años)</option>
        <option value="84">84 meses (7 años)</option>
        <option value="96">96 meses (8 años)</option>
        <option value="108">108 meses (9 años)</option>
        <option value="120">120 meses (10 años)</option>
        <option value="132">132 meses (11 años)</option>
        <option value="144">144 meses (12 años)</option>
        <option value="156">156 meses (13 años)</option>
        <option value="168">168 meses (14 años)</option>
        <option value="180">180 meses (15 años)</option>
      </select>

      <button type="submit" class="btn">Simular</button>
    </form>

    <div id="resultado" style="display: none;">
      <h3>Resultado de la Simulación</h3>
      <div class="resultado-item">
        <span>Cuota mensual:</span>
        <span id="resultadoCuota"></span>
      </div>
      <div class="resultado-item">
        <span>Total a pagar:</span>
        <span id="resultadoTotal"></span>
      </div>
    </div>

    <div id="alertas"></div>
  </div>

  <script>
    // Parámetros del sistema financiero basados en datos reales
    const TASA_INTERES_MENSUAL = 0.01780; // 1.780% mensual fija
    const SEGURO_VIDA = 0.00450; // 0.450% seguro de vida
    const VALOR_AVAL = 0.116; // 11.6% Valor Aval
    const ESTUDIO_CREDITO = 0.024; // 2.4% Estudio de Crédito
    const COMISION_BANCARIA = 5000; // $5,000 fijo
    const CUATRO_POR_MIL = 0.004; // 0.4% (4 por mil)

    // Función para calcular cuota mensual (Sistema Francés)
    function calcularCuotaFrances(capital, tasaMensual, plazoMeses) {
      if (tasaMensual === 0) return capital / plazoMeses;
      
      const factor = Math.pow(1 + tasaMensual, plazoMeses);
      return (capital * tasaMensual * factor) / (factor - 1);
    }

    // Formatear números con separadores de miles
    function formatearNumero(numero) {
      return new Intl.NumberFormat('es-CO', {
        style: 'currency',
        currency: 'COP',
        minimumFractionDigits: 0
      }).format(numero);
    }

    // Formatear input de monto
    document.getElementById('monto').addEventListener('input', function(e) {
      let valor = e.target.value.replace(/[^\d]/g, '');
      if (valor) {
        e.target.value = new Intl.NumberFormat('es-CO').format(valor);
      }
    });

    function calcularCuota() {
      const montoSolicitado = parseInt(document.getElementById('monto').value.replace(/[^\d]/g, ''));
      const plazo = parseInt(document.getElementById('plazo').value);
      
      // Validaciones básicas
      if (!montoSolicitado || !plazo) {
        mostrarAlerta('Por favor complete todos los campos');
        return;
      }
      
      if (plazo < 24 || plazo > 180) {
        mostrarAlerta('El plazo debe estar entre 24 y 180 meses');
        return;
      }
      
      // Tabla de referencia para $20,000,000
      const tablaReferencia = {
        24: 989889,
        36: 889888,
        48: 833335,
        60: 742140,
        72: 683514,
        84: 643440,
        96: 614854,
        108: 593857,
        120: 578095,
        132: 566061,
        144: 556765,
        156: 549513,
        168: 543813,
        180: 539306
      };
      
      const montoReferencia = 20000000;
      
      // Buscar la cuota de referencia para el plazo
      let cuotaReferencia = tablaReferencia[plazo];
      
      if (!cuotaReferencia) {
        mostrarAlerta('Plazo no disponible. Seleccione un plazo de la lista.');
        return;
      }
      
      // Cálculo usando regla de tres
      // Formula: (montoSolicitado * cuotaReferencia) / montoReferencia
      const cuotaAproximada = (montoSolicitado * cuotaReferencia) / montoReferencia;
      
      // Total a pagar
      const totalAPagar = cuotaAproximada * plazo;
      
      // Mostrar resultados
      document.getElementById('resultadoCuota').textContent = '$' + Math.round(cuotaAproximada).toLocaleString();
      document.getElementById('resultadoTotal').textContent = '$' + Math.round(totalAPagar).toLocaleString();
      
      document.getElementById('resultado').style.display = 'block';
      
      // Limpiar alertas
      document.getElementById('alertas').style.display = 'none';
    }
    
    // Manejar envío del formulario
    document.getElementById('simuladorForm').addEventListener('submit', function(e) {
      e.preventDefault();
      calcularCuota();
    });

    function mostrarAlerta(mensaje) {
      const alertas = document.getElementById('alertas');
      alertas.innerHTML = `<strong>⚠️ Error:</strong> ${mensaje}`;
      alertas.style.display = 'block';
      alertas.style.background = '#ff4444';
      alertas.style.color = 'white';
      alertas.style.padding = '10px';
      alertas.style.borderRadius = '8px';
      alertas.style.marginTop = '15px';
    }
  </script>
</body>
</html>

